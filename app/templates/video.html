{% extends "content_base.html" %}

{% block css %}
<link rel="stylesheet" href={{ url_for("static", filename="css/video.css") }}>
{% endblock %}



{% block content_mid_col_wrapper %}
<div class="video-player-box">
  <div class="video-player-header"></div>
  <div class="video-player-body">
    <!-- js load video -->
  </div>
  <div class="video-player-footer"></div>
</div>
<section class="video-description-box">
  <h1 class="video-description-head">
    {{ video_list[0][1] }}
  </h1>
  <p class="video-description-body">
    <!-- js load description -->
  </p>
</section>
{% endblock %}

{% block content_right_col %}
<div class="right-video-list-wrapper">
  <h1 class="video-list-title">视频列表</h1>
  <ul class="right-video-list">
    {% for folder, video in video_list %}
    <li class="video-list-item" data-folder-name={{ folder.replace(" ", "%20") }}
      data-video-name={{ video.replace(" ", "%20") }}>
      <img class="video-list-img" alt="暂无图片">
      <i class="fa fa-play play-hint" aria-hidden="true"></i>
      <section>
        <h4>{{ video }}</h4>
        <p>
          <i class="fa fa-youtube-play" aria-hidden="true"></i><span data-name="play_times">...</span>
          <i class="fa fa-keyboard-o" aria-hidden="true"></i><span data-name="comments_num">...</span>
        </p>
      </section>
    </li>
    {% endfor %}
  </ul>
</div>
{% endblock %}

{% block js %}
<script>
  jQuery(document).ready(function () {
    // 加载缩略图
    jQuery(".video-list-item").each(function () {
      var curItem = jQuery(this);
      var folderName = curItem.attr("data-folder-name")
      var videoName = curItem.attr("data-video-name");
      var url = "/static/video/" + folderName + "/" + videoName;
      var imgURL = url + ".jpg";
      curItem.attr("data-url", url).children(".video-list-img").attr("src", imgURL);
    });
    // 激活列表第一项
    var firstItem = jQuery(".video-list-item").first();
    firstItem.addClass("list-item-active");
    textURL = firstItem.attr("data-url") + ".txt"
    jQuery(".video-description-body").load(textURL);
    var videoURL = firstItem.attr("data-url") + ".mp4";
    var html = '<video width=100% height=480px controls><source src="'
      + videoURL
      + '" type = "video/mp4"></video>'
    jQuery(".video-player-body").html(html);
    // 视频列表效果
    jQuery(".video-list-item").hover(function () {
      jQuery(this).children("i.play-hint").stop(false, true).fadeToggle("fast");
    });
    // 切换视频
    jQuery(".video-list-item").click(function () {
      var curItem = jQuery(this);
      if (!curItem.hasClass("list-item-active")) {
        jQuery(".list-item-active").removeClass("list-item-active");
        curItem.addClass("list-item-active");
        jQuery(".video-description-head").text(curItem.find("h4").text());
        var textURL = curItem.attr("data-url") + ".txt"
        jQuery(".video-description-body").load(textURL);
        var videoURL = curItem.attr("data-url") + ".mp4";
        var html = '<video width=100% height=480px controls><source src="'
          + videoURL
          + '" type = "video/mp4"></video>'
        jQuery(".video-player-body").html(html);
      }
    });
  });
</script>
{% endblock %}